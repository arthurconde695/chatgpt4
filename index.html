<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="carro.jpg" type="image/x-icon">
    <title>ChatCar</title>
    <link rel="stylesheet" href="style.css">
    
</head>
<body>
    <div class="container">
        <label for="prompt">Insira seu prompt</label>
        <textarea cols="40" rows="5" name="prompt" id="prompt"></textarea>
        
        <div id="chat-log" class="chat-log"></div>

        <button id="send-btn">Enviar</button>
    </div>

    <footer>
        <div class="footer-container">
            <p>&copy; 2024 ChatCar. Todos os direitos reservados.</p>
            <ul>
                <li>Arthur Conde Ferri</li>
                <li>condeferriarthur@gmail.com</li>
                <li>IFPR</li>
            </ul>
        </div>
    </footer>

    <script type="module">
        // Carregue o pacote via CDN
        import { GoogleGenerativeAI } from "https://esm.sh/@google/generative-ai";

        // Chave de API (lembre-se de mantê-la privada em produção)
        const API_KEY = "AIzaSyB-BZicHWUgPzWriX8DhEf4Ap4x6lrNB3o";

        // Instanciar a API
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        const historicoConversa = [];

        async function obterRespostaDoBot(mensagemUsuario) {
            try {
                historicoConversa.push({ role: "user", content: mensagemUsuario });

                const historicoLimitado = historicoConversa.slice(-3);
                const contexto = historicoLimitado.map(item => `${item.role}: ${item.content}`).join('\n');

                const prompt = `Fale sobre assuntos do mundo automotivo e de carros, e você odeia carros elétricos, e quando o assunto for carro elétrico seja o mais grosso possível: \n${contexto}`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = await response.text();

                historicoConversa.push({ role: "bot", content: text });

                adicionarMensagemBot(text);
            } catch (error) {
                console.error("Erro ao obter resposta do bot:", error);
                adicionarMensagemBot("Erro ao responder. Tente novamente.");
            }
        }

        function adicionarMensagemUsuario(mensagem) {
            const novaDiv = document.createElement("div");
            novaDiv.className = "user-message";
            novaDiv.textContent = mensagem;
            document.getElementById("chat-log").appendChild(novaDiv);
            document.getElementById("chat-log").scrollTop = document.getElementById("chat-log").scrollHeight;
        }

        function adicionarMensagemBot(mensagem) {
            const novaDiv = document.createElement("div");
            novaDiv.className = "bot-message";
            novaDiv.textContent = mensagem;
            document.getElementById("chat-log").appendChild(novaDiv);
            document.getElementById("chat-log").scrollTop = document.getElementById("chat-log").scrollHeight;
        }

        document.getElementById("send-btn").addEventListener("click", () => {
            const userInput = document.getElementById("prompt").value;
            if (userInput.trim() !== "") {
                adicionarMensagemUsuario(userInput);
                obterRespostaDoBot(userInput);
                document.getElementById("prompt").value = "";
            }
        });
    </script>
</body>
</html>
